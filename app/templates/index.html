
<!DOCTYPE html>
<html>
<head>

	<title>Canada FSA</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
	<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>


</head>
<body>



<div id="mapid" style="height: 1000px;"></div>
<script>

	// initialize map and set zoom
	var mymap = L.map('mapid').setView([43.6329761,-79.3542285], 8);

	// add tiles
	var map_tl  = L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/outdoors-v10/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiZGxpbjE3IiwiYSI6ImNpcmsyMGxudzAwMnlmYm5icXlzYWsxd2IifQ.MUxIcntS8U8rRa41fbPo_Q', {
		minZoom: 1,
		maxZoom: 20,
		attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
			'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
		id: 'mapbox.streets'
	});

	map_tl.addTo(mymap);

	function getColor(d) {
		return d > 30 ? '#550000' :
			   d > 20 ? '#801515' :
			   d > 10 ? '#D46A6A' :
			   d > 3 ? '#FFAAAA' :
			   			'#A7A7A7';
	}

	var fsa = L.geoJSON(false, {
					style: function(feature) {
						console.log(feature)
						return {
							fillColor: getColor(feature.properties.colour),
							weight: 0,
							fillOpacity: 1,
							color: '#D3D3D3'
						}
					}
				}).addTo(mymap);

	// 		var geojsonFeature = {
	// 		    "type": "Feature",
	// 		    "properties": {
	// 		        "name": "Coors Field",
	// 		        "amenity": "Baseball Stadium",
	// 		        "popupContent": "This is where the Rockies play!"
	// 		    },
	// 		    "geometry": {
	// 		        "type": "MultiPolygon",
	// 		        "coordinates": [[[[-79.48690739599994, 43.618093904000034], [-79.48733699999997, 43.61727119500006], [-79.48848129599997, 43.61760150600003], [-79.48951479599998, 43.617903296000065], [-79.48960088599995, 43.61793141000004], [-79.48968599799997, 43.61799558900003], [-79.48880120799998, 43.61868619400008], [-79.48690739599994, 43.618093904000034]]], [[[-79.37624051399996, 43.670787706000056], [-79.37577510299997, 43.66964660700006], [-79.37537778899997, 43.66874048900007], [-79.37517901099994, 43.668296514000076], [-79.37466569099996, 43.66709171100007], [-79.37484269899994, 43.66696819500004], [-79.37499438799995, 43.66686229700008], [-79.37515850199998, 43.666756607000025], [-79.37533469199997, 43.666660008000065], [-79.37552289999996, 43.66658170800008], [-79.37569839199995, 43.666512096000076], [-79.37583580299997, 43.666478099000074], [-79.37490314099995, 43.66540616700007], [-79.37304730699998, 43.66317900400003], [-79.37433210799998, 43.66290919100004], [-79.37556710699994, 43.662649886000054], [-79.37670199599995, 43.66241159100008], [-79.37786200899995, 43.662167003000036], [-79.37799559799998, 43.66213068800005], [-79.37806890099995, 43.662331004000066], [-79.37817720899994, 43.662589292000064], [-79.37819198799997, 43.662649387000044], [-79.37819748099997, 43.662676703000045], [-79.37820060999996, 43.66269179900007], [-79.37820119199995, 43.66273241000005], [-79.37819831899998, 43.66278099600004], [-79.37820351399995, 43.66282291300007], [-79.37833310899998, 43.66309978900006], [-79.37888319099994, 43.662981702000025], [-79.37895670999995, 43.66296589700005], [-79.37953039399997, 43.662847887000055], [-79.37974189199997, 43.66282389300005], [-79.37935818699998, 43.66187309400004], [-79.38146628399994, 43.66142580400003], [-79.38166579999995, 43.661383589000025], [-79.38181529299999, 43.661358705000055], [-79.38193930799997, 43.66136040200007], [-79.38242391499995, 43.66136730100004], [-79.38257158899995, 43.66136939200004], [-79.38309250499998, 43.66136770500003], [-79.38371808699998, 43.661239806000026], [-79.38584249799999, 43.660809191000055], [-79.38587161599997, 43.66086679500006], [-79.38606889199997, 43.66137378700006], [-79.38609131399994, 43.66146408900005], [-79.38608889699998, 43.661554187000036], [-79.38608670799994, 43.66163520400005], [-79.38609739899994, 43.66169829000006], [-79.38611979399997, 43.66178869200007], [-79.38637448999998, 43.66246761000008], [-79.38571611399993, 43.662601805000065], [-79.38571350999996, 43.66260229900007], [-79.38555141299997, 43.66263599600006], [-79.38439298799995, 43.66288039900007], [-79.38439138899997, 43.66288070600007], [-79.38378000199998, 43.66301619200004], [-79.38412971199995, 43.66384951400005], [-79.38414520599997, 43.66389749900003], [-79.38458351399998, 43.66493069900008], [-79.38494319399996, 43.66484930200005], [-79.38498359499994, 43.664840207000054], [-79.38516778099995, 43.664798510000026], [-79.38540179299997, 43.664745492000065], [-79.38544028999996, 43.66473678700004], [-79.38717090299997, 43.66436110700005], [-79.38743431099994, 43.66496890800005], [-79.38570169699994, 43.66536289700008], [-79.38590899899998, 43.665859107000074], [-79.38599339699994, 43.66583989900005], [-79.38612168199995, 43.66584020800008], [-79.38614728599998, 43.66583698900007], [-79.38617529399994, 43.66583670500006], [-79.38636159699996, 43.66583519500006], [-79.38654100599996, 43.665836710000065], [-79.38670058699995, 43.66583439100003], [-79.38680200099998, 43.66581679300003], [-79.38685050199996, 43.66580799500008], [-79.38694599999997, 43.66579049000006], [-79.38700530399996, 43.66577869400004], [-79.38771168599999, 43.66563829900008], [-79.38809310499994, 43.66647940300004], [-79.38811360299997, 43.66652690600006], [-79.38793531299996, 43.666575401000046], [-79.38790811699994, 43.66657979800004], [-79.38785310299994, 43.666588809000075], [-79.38782520899997, 43.66659330900006], [-79.38779730799996, 43.66659770700005], [-79.38776899199996, 43.66659769200004], [-79.38774109699995, 43.666597687000035], [-79.38771280299994, 43.66660210400005], [-79.38768409399995, 43.66660211000004], [-79.38765581299998, 43.666602100000034], [-79.38762749099999, 43.66660211000004], [-79.38759930499998, 43.666602012000055], [-79.38757140899997, 43.66659750000008], [-79.38754308699998, 43.66659751000003], [-79.38620910599997, 43.66647620800006], [-79.38616609499996, 43.66648659100008], [-79.38632708799997, 43.66679570800005], [-79.38647638499998, 43.66714998800006], [-79.38747379199998, 43.66695481100004], [-79.38748209999994, 43.66695319300004], [-79.38823028899998, 43.66680661100003], [-79.38849890199998, 43.667431702000044], [-79.38790059099995, 43.667540286000076], [-79.38822759699997, 43.66830119600007], [-79.38863909299994, 43.66821698900003], [-79.38886299199999, 43.66819309300007], [-79.38949358299999, 43.669660606000036], [-79.38800940499993, 43.66996390800006], [-79.38739821199994, 43.67009029900004], [-79.38677461499998, 43.670216509000056], [-79.38603851199997, 43.67037719900003], [-79.38580498599998, 43.66983370000003], [-79.38586643699995, 43.66982103600003], [-79.38654091199999, 43.66968200000008], [-79.38641289999998, 43.66936509400006], [-79.38590140499997, 43.66947490600006], [-79.38586710299995, 43.669482705000064], [-79.38586398399997, 43.669483408000076], [-79.38435421199995, 43.66981319300004], [-79.38279469599996, 43.670151291000025], [-79.38314289199997, 43.67103859600007], [-79.38236910899997, 43.67121671000007], [-79.38055399399997, 43.671604194000054], [-79.38007649399998, 43.67042108700008], [-79.37989329899995, 43.66996729300007], [-79.37977100199998, 43.67018259100007], [-79.37966169399994, 43.67039758800007], [-79.37959068699996, 43.67053728900004], [-79.37941918599995, 43.67100990400007], [-79.37937931399995, 43.671137791000035], [-79.37936020299998, 43.67125259800008], [-79.37936048599994, 43.67136639000006], [-79.37936951099994, 43.67149629200003], [-79.37945434699998, 43.67181410200004], [-79.37945070399996, 43.67181465200008], [-79.37945040499994, 43.671814711000025], [-79.37940030799996, 43.671832006000045], [-79.37933781299995, 43.67184909900004], [-79.37908839399995, 43.67189960200005], [-79.37908324699998, 43.671900754000035], [-79.37905089499998, 43.67190798900003], [-79.37684330199994, 43.67235390400003], [-79.37650798799996, 43.671448801000054], [-79.37643850899997, 43.67126769300006], [-79.37624051399996, 43.670787706000056]]]]
	// 		    }
	// 		};
	//
	// L.geoJSON(geojsonFeature).addTo(mymap);

	// load markers based on map bounds
	function loadFSAs() {
		var bounds = mymap.getBounds();
		var ne = bounds._northEast;
		var sw = bounds._southWest;

		console.log(bounds)

		// make call to get geoJSON of all FSAs in view
		$.ajax({
			url: 'fsa_api',
			data: {
					minlat : sw.lat,
					minlng : sw.lng,
					maxlat : ne.lat,
					maxlng : ne.lng
				},
			type: "GET",
			dataType: 'json',
			complete: function(data) {
				parsed_data = jQuery.parseJSON(data.responseText)
				console.log(data)
				fsa.clearLayers();

				fsa.addData(parsed_data);
			}
		});
	}


	loadFSAs();

</script>



</body>
</html>
